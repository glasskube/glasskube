{{ define "content" }}
  <!-- TODO why are we restoring main on historyRestore but only overview-swapped in sse ? -->
  <div
    class="container-lg my-2"
    hx-trigger="htmx:historyRestore from:body"
    hx-get="/packages"
    hx-select="main"
    hx-target="main"
    hx-swap="outerHTML">
    <div
      class="m-0 p-0"
      id="package-overview-swapped"
      hx-trigger="sse:refresh-package-overview"
      hx-get="/packages"
      hx-swap="innerHTML"
      hx-select="#package-overview-swapped"
      hx-target="#package-overview-swapped">
      {{ template "pkg-update-alert" . | ForPkgUpdateAlert }}
      <div class="row row-cols-1 g-2">
        <div>
          <h2 class="text-reset">Installed Packages</h2>

          {{ if eq (len .InstalledPackages) 0 }}
            <p>No packages installed yet in your cluster. You might want to try one of the packages below.</p>
          {{ end }}

          {{ range .InstalledPackages }}
            <div class="col mt-2">
              <div class="card bg-body-secondary h-100 border-primary border-1">
                <div class="card-body d-flex flex-column p-1">
                  <!-- TODO the "header" of the card should link to nothing or to the first instance, if only one exists ?? -->
                  <a
                    class="flex-grow-1 d-flex align-items-center gap-1 text-reset text-decoration-none p-1"
                    hx-select="main"
                    hx-target="main"
                    hx-swap="outerHTML"
                    hx-boost="true">
                    <div class="flex-shrink-0 align-self-center">
                      {{ if eq .IconUrl "" }}
                        <!-- TODO the glasskube logo as fallback is probably not the best idea? -->
                        <img
                          src="/static/assets/glasskube-logo.svg"
                          alt="{{ .Name }}"
                          style="width: 3.25rem; height: auto;" />
                      {{ else }}
                        <img src="{{ .IconUrl }}" alt="{{ .Name }}" style="width: 2rem; height: auto;" />
                      {{ end }}
                    </div>
                    <div class="flex-grow-1 align-self-start">
                      <h6 class="text-reset m-0">{{ .Name }}</h6>
                      <span
                        class="lh-sm overflow-hidden"
                        style="
                        font-size: small;
                        display: -webkit-box;
                        -webkit-box-orient: vertical;
                        -webkit-line-clamp: 2;">
                        {{ .ShortDescription }}
                      </span>
                    </div>
                  </a>
                  <table class="table table-sm table-borderless m-0">
                    <thead>
                      <tr>
                        <th scope="col" class="bg-body-secondary p-0">Name</th>
                        <th scope="col" class="bg-body-secondary p-0">Namespace</th>
                        <th scope="col" class="bg-body-secondary p-0">Status</th>
                      </tr>
                    </thead>
                    <tbody>
                      {{ range .Packages }}
                        <tr>
                          <td class="bg-body-secondary p-0">
                            <!-- TODO link should span across the entire row!! -->
                            <a
                              href="/packages/{{ .Name }}/{{ .Package.Namespace }}/{{ .Package.Name }}"
                              hx-select="main"
                              hx-target="main"
                              hx-swap="outerHTML"
                              hx-boost="true">
                              {{ .Package.Name }}
                            </a>
                          </td>
                          <td class="bg-body-secondary p-0">{{ .Package.Namespace }}</td>
                          <td class="bg-body-secondary p-0">{{ .Status.Status }}</td>
                        </tr>
                      {{ end }}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          {{ end }}
        </div>
        <div>
          <h2 class="text-reset">Available Packages</h2>

          <div class="row row-cols-3 row-cols-xl-4 g-2">
            {{ range .AvailablePackages }}
              <!-- TODO make this a reusable template -->
              <div class="col">
                <div class="card bg-body-secondary h-100 border-primary border-1">
                  <div class="card-body d-flex flex-column p-0">
                    <a
                      class="flex-grow-1 d-flex align-items-center gap-1 text-reset text-decoration-none p-1"
                      href="/packages/{{ .Name }}"
                      hx-select="main"
                      hx-target="main"
                      hx-swap="outerHTML"
                      hx-boost="true">
                      <div class="flex-shrink-0 align-self-center">
                        {{ if eq .IconUrl "" }}
                          <!-- TODO the glasskube logo as fallback is probably not the best idea? -->
                          <img
                            src="/static/assets/glasskube-logo.svg"
                            alt="{{ .Name }}"
                            style="width: 3.25rem; height: auto;" />
                        {{ else }}
                          <img src="{{ .IconUrl }}" alt="{{ .Name }}" style="width: 3.25rem; height: auto;" />
                        {{ end }}
                      </div>
                      <div class="flex-grow-1 align-self-start">
                        <h6 class="text-reset m-0">{{ .Name }}</h6>
                        <span
                          class="lh-sm overflow-hidden"
                          style="
                        font-size: small;
                        display: -webkit-box;
                        -webkit-box-orient: vertical;
                        -webkit-line-clamp: 2;">
                          {{ .ShortDescription }}
                        </span>
                      </div>
                    </a>
                    <div class="mb-1 mx-1">
                      <a
                        href="/packages/{{ .Name }}#configuration"
                        hx-boost="true"
                        hx-select="main"
                        hx-target="main"
                        hx-swap="outerHTML"
                        class="btn btn-primary btn-sm w-100"
                        >Install</a
                      >
                    </div>
                  </div>
                </div>
              </div>
            {{ end }}
          </div>
        </div>
      </div>
    </div>
  </div>
{{ end }}

{{ define "installed-pkg-table-cell" }}

{{ end }}
